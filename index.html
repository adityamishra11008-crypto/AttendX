<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AttendX by Adishra</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
  <style>
    body { background-color: #f8f9fa; }
    .card { border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.08); }
    .present { background-color: #d4edda; }
    .absent { background-color: #f8d7da; }
    h2 { font-weight: bold; }
    @media (max-width: 576px) {
      table { font-size: 14px; }
      .input-group button { min-width: 80px; }
    }
  </style>
</head>
<body class="container py-4">

  <h2 class="mb-4 text-center">üìãAttendX by Adishra</h2>

  <!-- Attendance Details -->
  <div class="card p-3 mb-3">
    <div class="row g-3">
      <div class="col-12 col-md-4">
        <input type="date" id="date" class="form-control">
      </div>
      <div class="col-12 col-md-4">
        <input type="text" id="branch" class="form-control" placeholder="Branch">
      </div>
      <div class="col-12 col-md-4">
        <input type="text" id="subject" class="form-control" placeholder="Subject">
      </div>
    </div>
  </div>

  <!-- Toggle Student List -->
  <button class="btn btn-primary mb-3 w-100" id="toggleStudents">Manage Students</button>

  <!-- Student Management -->
  <div class="card p-3 mb-3" id="studentPanel" style="display:none;">
    <div class="input-group mb-3">
      <input type="text" id="studentName" class="form-control" placeholder="Enter student name">
      <button class="btn btn-success" onclick="addStudent()">Add</button>
    </div>

    <!-- Bulk Add Students -->
    <button class="btn btn-warning mb-2 w-100" id="bulkAddToggle">Bulk Add Students</button>
    <div id="bulkAddPanel" style="display:none;">
      <textarea id="bulkStudentNames" class="form-control mb-2" rows="4" placeholder="Enter student names separated by commas or new lines"></textarea>
      <button class="btn btn-success w-100" onclick="bulkAddStudents()">Add All</button>
    </div>

    <ul class="list-group mt-3" id="studentList"></ul>
  </div>

  <!-- Search Box -->
  <input type="text" id="searchStudent" class="form-control mb-3" placeholder="üîç Search student...">
  
  <!-- Attendance Table -->
  <div class="card p-3 table-responsive">
    <table class="table table-bordered" id="studentTable">
      <thead class="table-dark">
        <tr>
          <th>Name</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Export Button -->
  <button class="btn btn-success mt-3 w-100" onclick="exportPresentPDF()">Export Present Students PDF</button>
  <hr>
  <div class="text-center muted-small mb-4">Made by Aditya Mishra ‚ù§</div>

<script>
let students = JSON.parse(localStorage.getItem("students")) || [];

// Toggle panels
document.getElementById("toggleStudents").addEventListener("click", () => {
  const panel = document.getElementById("studentPanel");
  panel.style.display = panel.style.display === "none" ? "block" : "none";
});

document.getElementById("bulkAddToggle").addEventListener("click", () => {
  const panel = document.getElementById("bulkAddPanel");
  panel.style.display = panel.style.display === "none" ? "block" : "none";
});

// Add single student
function addStudent() {
  let name = document.getElementById("studentName").value.trim();
  if (name && !students.includes(name)) {
    students.push(name);
    saveStudents();
    updateStudentList();
    document.getElementById("studentName").value = "";
  }
}

// Bulk add students
function bulkAddStudents() {
  let namesText = document.getElementById("bulkStudentNames").value.trim();
  if (!namesText) {
    alert("Please enter student names");
    return;
  }
  let namesArray = namesText.split(/[\n,]+/).map(name => name.trim()).filter(name => name);
  let addedCount = 0;
  namesArray.forEach(name => {
    if (name && !students.includes(name)) {
      students.push(name);
      addedCount++;
    }
  });
  if (addedCount > 0) {
    saveStudents();
    updateStudentList();
    document.getElementById("bulkStudentNames").value = "";
    alert(`${addedCount} students added successfully!`);
  } else {
    alert("No new students were added.");
  }
}

// Save to localStorage
function saveStudents() {
  localStorage.setItem("students", JSON.stringify(students));
}

// Update UI
function updateStudentList() {
  let list = document.getElementById("studentList");
  let tableBody = document.querySelector("#studentTable tbody");
  list.innerHTML = "";
  tableBody.innerHTML = "";

  students.forEach((student, index) => {
    let li = document.createElement("li");
    li.className = "list-group-item d-flex justify-content-between align-items-center";
    li.innerHTML = `${student} <button class="btn btn-sm btn-danger" onclick="removeStudent(${index})">Remove</button>`;
    list.appendChild(li);

    let row = document.createElement("tr");
    row.innerHTML = `
      <td>${student}</td>
      <td>
        <select class="form-select" onchange="updateRowStyle(this)">
          <option value="" selected disabled>-- Select --</option>
          <option value="Present">Present</option>
          <option value="Absent">Absent</option>
        </select>
      </td>
    `;
    tableBody.appendChild(row);
  });
}

// Remove student
function removeStudent(index) {
  students.splice(index, 1);
  saveStudents();
  updateStudentList();
}

// Update row color
function updateRowStyle(select) {
  let row = select.closest("tr");
  row.className = select.value === "Present" ? "present" : 
                  select.value === "Absent" ? "absent" : "";
}

// Export only present students
function exportPresentPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  let date = document.getElementById("date").value;
  let branch = document.getElementById("branch").value;
  let subject = document.getElementById("subject").value;

  let tableData = [];
  document.querySelectorAll("#studentTable tbody tr").forEach(row => {
    let name = row.querySelector("td:first-child").innerText;
    let status = row.querySelector("select").value;
    if (status === "Present") {
      tableData.push([name, status]);
    }
  });

  if (tableData.length === 0) {
    alert("No present students to export!");
    return;
  }

  doc.text(`Attendance - ${date || "N/A"} | ${branch || "N/A"} | ${subject || "N/A"}`, 14, 10);
  doc.autoTable({
    head: [["Name", "Status"]],
    body: tableData
  });

  doc.save("Present_Students.pdf");
}

// Search
document.getElementById("searchStudent").addEventListener("input", function() {
  let searchText = this.value.toLowerCase();
  document.querySelectorAll("#studentTable tbody tr").forEach(row => {
    let name = row.querySelector("td:first-child").innerText.toLowerCase();
    row.style.display = name.includes(searchText) ? "" : "none";
  });
});

// Load on page start
updateStudentList();
</script>

</body>
</html>